---
import Blank from '$layout/blank.astro'
import Success from 'src/components/success.astro';

type Mode = 'login' | 'success'
let mode = 'login'

// on POST
if (Astro.request.method === 'POST') {
  // validate
  try {
    const data = await Astro.request.formData()

    const nickname = data.get('nickname')
    const idCard = data.get('idCard')

    console.log(data)

    if (nickname === 'mock') {
      mode = 'success'
      return Astro.redirect('https://ywc.in.th')
    } else {
      mode = 'Nickname or ID card is incorrect'
      Astro.response.status = 401
    }
  } catch (e) {
    Astro.response.status = 401
  }
}
---

{mode === 'success' ? (
  <Success />
) : (
<Blank>
  <h1 class="text-4xl font-bold text-white text-center pb-10">เข้าสู่ระบบ Wi-Fi</h1>
  {mode !== 'login' && (
    <div class="bg-red-300 p-6 font-serif rounded-2xl space-y-4 mb-6 text-red-950">
      Failed to authenticate
    </div>
  )}
  <form class="bg-[#f3f3f3] p-6 font-serif rounded-2xl space-y-4" method="post">
    <div>
      <label for="nickname" class="block"
        >ชื่อเล่น<span class="text-red-500">*</span></label
      >
      <input id="nickname" name="nickname" type="text" class="w-full p-4 rounded-lg border border-[#777777]" required />
    </div>
    <div>
      <label for="idCard" class="block"
        >เลขบัตรประจำตัวประชาชน<span class="text-red-500">*</span></label
      >
      <input id="idCard" name="idCard" type="text" class="w-full p-4 rounded-lg border border-[#777777]" required />
    </div>
    <div class="flex justify-center">
      <button type="submit" class="font-semibold px-6 py-4 rounded-lg bg-[#07e23e]">เข้าสู่ระบบ</button>
    </div>
  </form>
</Blank>
)}
